## DNS
域名系统（Domain Name System）

### DNS解析
就是域名解析。通过域名，最终得到该域名对应的IP地址的过程
```shell
www.zuofc.com (域名)  - DNS解析 -> 111.222.33.444 (IP地址)
```

### DNS缓存
DNS查询过程：
1. 首先搜索浏览器自身DNS缓存，如果存在，则域名解析到此完成
2. 如果浏览器自身的缓存里面没有找到对应的条目，那么会尝试读取操作系统hosts文件看是否存在对应的映射关系，如果存在，则域名解析到此完成
3. 如果本地host文件不存在映射关系，则查找DNS服务器
4. 如果DNS服务器还找不到，回向根服务器发送请求，进行递归查询

## CDN

**内容分发网络（Content Dilivery Network，CDN）是一个专门用来分发内容的分布式应用。**

CDN 构建在现有的互联网之上，通过在各地部署数据中心，让不同地域的用户可以就近获取内容。这里的内容通常指的是文件、图片、视频、声音、应用程序安装包等，它们具有一个显著的特征——**无状态，或者说是静态的**。这些资源不像订单数据、库存数据等，它们一旦发布，就很少会发生变化。另一个显著的特征，是这些资源往往会被大量的用户需要，因此分发它们的流量成本是较高的。

### CDN缓存
在浏览器本地缓存失效后，浏览器回想CDN边缘节点发起请求，类似浏览器缓存。
当浏览器向CDN节点请求数据时，CDN节点会判断缓存数据是否过期，若缓存数据并没有过期，则直接将缓存数据返回给客户端；否则，CDN节点就会向服务器发出回源请求，从服务器拉取最新数据，更新本地缓存，并将最新数据返回给客户端。 CDN服务商一般会提供基于文件后缀、目录多个维度来指定CDN缓存时间，为用户提供更精细化的缓存管理。

### 优点（为什么要使用cdn）

- 负载均衡，单点请求容易造成服务器压力过大，导致延迟高。
- 防止单点故障
- 在离用户更近的地理位置提供资源，可以减少延迟。按照地理位置分散地提供资源，也可以降低中心化带来的服务压力。

### 内容分发（CDN如何工作的）

CDN 是一个分布式的内容分发网络。当用户请求一个静态资源的时候，首先会触发域名系统的解析。域名系统会将解析的责任交由 CDN 提供商来处理，CDN 的智能 DNS 服务会帮助用户选择离自己距离最近的节点，返回这个节点的 A（或 AAAA）记录。然后客户端会向 CDN 的资源节点发起请求，最终获得资源。

![](https://s0.lgstatic.com/i/image6/M00/41/EE/CioPOWCvAPCAKWMAAAM_tmZAhpc658.png)

### 回源

CDN 回源就是 CDN 节点到源站请求资源，重新设置缓存。

整个过程是 4 个层级。用户请求静态资源通常用自己的域名（防止跨域和一些安全问题）。为了让用户请求的是自己的网站，而使用的是 CDN 的服务，这里会使用 CNAME 让自己的域名作为 CDN 域名的一个别名。当请求到 CDN 服务的时候，会首先由 CDN 的 DNS 服务帮助用户选择一个最优的节点，这个 DNS 服务还充当了负载均衡的作用。接下来，用户开始向 CDN 节点请求资源。如果这个时候资源已经过期或者还没有在 CDN 节点上，就会从源站读取数据。

![](https://s0.lgstatic.com/i/image6/M01/41/89/Cgp9HWCsuLeABoBAAAJfmJcMOc0952.png)

### 如何造成回源

- CDN 节点没有对应资源时主动到源站获取资源
- 缓存失效后，CDN 节点到源站获取资源
- 在 CDN 管理后台或者使用开放接口主动刷新触发回源。